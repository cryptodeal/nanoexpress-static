'use strict';

var fs = require('fs');
var path = require('path');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var fs__default = /*#__PURE__*/_interopDefaultLegacy(fs);
var path__default = /*#__PURE__*/_interopDefaultLegacy(path);

const mimes = {
  '3gp': 'video/3gpp',
  a: 'application/octet-stream',
  ai: 'application/postscript',
  aif: 'audio/x-aiff',
  aiff: 'audio/x-aiff',
  asc: 'application/pgp-signature',
  asf: 'video/x-ms-asf',
  asm: 'text/x-asm',
  asx: 'video/x-ms-asf',
  atom: 'application/atom+xml',
  au: 'audio/basic',
  avi: 'video/x-msvideo',
  bat: 'application/x-msdownload',
  bin: 'application/octet-stream',
  bmp: 'image/bmp',
  bz2: 'application/x-bzip2',
  c: 'text/x-c',
  cab: 'application/vnd.ms-cab-compressed',
  cc: 'text/x-c',
  chm: 'application/vnd.ms-htmlhelp',
  class: 'application/octet-stream',
  com: 'application/x-msdownload',
  conf: 'text/plain',
  cpp: 'text/x-c',
  crt: 'application/x-x509-ca-cert',
  css: 'text/css',
  csv: 'text/csv',
  cxx: 'text/x-c',
  deb: 'application/x-debian-package',
  der: 'application/x-x509-ca-cert',
  diff: 'text/x-diff',
  djv: 'image/vnd.djvu',
  djvu: 'image/vnd.djvu',
  dll: 'application/x-msdownload',
  dmg: 'application/octet-stream',
  doc: 'application/msword',
  dot: 'application/msword',
  dtd: 'application/xml-dtd',
  dvi: 'application/x-dvi',
  ear: 'application/java-archive',
  eml: 'message/rfc822',
  eps: 'application/postscript',
  exe: 'application/x-msdownload',
  f: 'text/x-fortran',
  f77: 'text/x-fortran',
  f90: 'text/x-fortran',
  flv: 'video/x-flv',
  for: 'text/x-fortran',
  gem: 'application/octet-stream',
  gemspec: 'text/x-script.ruby',
  gif: 'image/gif',
  gz: 'application/x-gzip',
  h: 'text/x-c',
  hh: 'text/x-c',
  htm: 'text/html',
  html: 'text/html',
  ico: 'image/vnd.microsoft.icon',
  ics: 'text/calendar',
  ifb: 'text/calendar',
  iso: 'application/octet-stream',
  jar: 'application/java-archive',
  java: 'text/x-java-source',
  jnlp: 'application/x-java-jnlp-file',
  jpeg: 'image/jpeg',
  jpg: 'image/jpeg',
  js: 'application/javascript',
  json: 'application/json',
  log: 'text/plain',
  m3u: 'audio/x-mpegurl',
  m4v: 'video/mp4',
  man: 'text/troff',
  mathml: 'application/mathml+xml',
  mbox: 'application/mbox',
  mdoc: 'text/troff',
  me: 'text/troff',
  mid: 'audio/midi',
  midi: 'audio/midi',
  mime: 'message/rfc822',
  mjs: 'application/javascript',
  mml: 'application/mathml+xml',
  mng: 'video/x-mng',
  mov: 'video/quicktime',
  mp3: 'audio/mpeg',
  mp4: 'video/mp4',
  mp4v: 'video/mp4',
  mpeg: 'video/mpeg',
  mpg: 'video/mpeg',
  ms: 'text/troff',
  msi: 'application/x-msdownload',
  odp: 'application/vnd.oasis.opendocument.presentation',
  ods: 'application/vnd.oasis.opendocument.spreadsheet',
  odt: 'application/vnd.oasis.opendocument.text',
  ogg: 'application/ogg',
  p: 'text/x-pascal',
  pas: 'text/x-pascal',
  pbm: 'image/x-portable-bitmap',
  pdf: 'application/pdf',
  pem: 'application/x-x509-ca-cert',
  pgm: 'image/x-portable-graymap',
  pgp: 'application/pgp-encrypted',
  pkg: 'application/octet-stream',
  pl: 'text/x-script.perl',
  pm: 'text/x-script.perl-module',
  png: 'image/png',
  pnm: 'image/x-portable-anymap',
  ppm: 'image/x-portable-pixmap',
  pps: 'application/vnd.ms-powerpoint',
  ppt: 'application/vnd.ms-powerpoint',
  ps: 'application/postscript',
  psd: 'image/vnd.adobe.photoshop',
  py: 'text/x-script.python',
  qt: 'video/quicktime',
  ra: 'audio/x-pn-realaudio',
  rake: 'text/x-script.ruby',
  ram: 'audio/x-pn-realaudio',
  rar: 'application/x-rar-compressed',
  rb: 'text/x-script.ruby',
  rdf: 'application/rdf+xml',
  roff: 'text/troff',
  rpm: 'application/x-redhat-package-manager',
  rss: 'application/rss+xml',
  rtf: 'application/rtf',
  ru: 'text/x-script.ruby',
  s: 'text/x-asm',
  sgm: 'text/sgml',
  sgml: 'text/sgml',
  sh: 'application/x-sh',
  sig: 'application/pgp-signature',
  snd: 'audio/basic',
  so: 'application/octet-stream',
  svg: 'image/svg+xml',
  svgz: 'image/svg+xml',
  swf: 'application/x-shockwave-flash',
  t: 'text/troff',
  tar: 'application/x-tar',
  tbz: 'application/x-bzip-compressed-tar',
  tcl: 'application/x-tcl',
  tex: 'application/x-tex',
  texi: 'application/x-texinfo',
  texinfo: 'application/x-texinfo',
  text: 'text/plain',
  tif: 'image/tiff',
  tiff: 'image/tiff',
  torrent: 'application/x-bittorrent',
  tr: 'text/troff',
  txt: 'text/plain',
  vcf: 'text/x-vcard',
  vcs: 'text/x-vcalendar',
  vrml: 'model/vrml',
  war: 'application/java-archive',
  wav: 'audio/x-wav',
  wma: 'audio/x-ms-wma',
  wmv: 'video/x-ms-wmv',
  wmx: 'video/x-ms-wmx',
  wrl: 'model/vrml',
  wsdl: 'application/wsdl+xml',
  xbm: 'image/x-xbitmap',
  xhtml: 'application/xhtml+xml',
  xls: 'application/vnd.ms-excel',
  xml: 'application/xml',
  xpm: 'image/x-xpixmap',
  xsl: 'application/xml',
  xslt: 'application/xslt+xml',
  yaml: 'text/yaml',
  yml: 'text/yaml',
  zip: 'application/zip',
  default: 'text/html'
};

const getMime = (path) => {
  const i = path.lastIndexOf('.');
  return mimes[path.substr(i + 1).toLowerCase()];
};

/* eslint-disable eslint-comments/disable-enable-pair, @typescript-eslint/no-use-before-define */

function handleDirectory(dirPath) {
  if (fs__default['default'].statSync(dirPath).isDirectory()) {
    return {
      files: precacheStatic(dirPath),
      reduce: true
    };
  }
  return undefined;
}

function precacheFolder(dirPath) {
  try {
    const files = fs__default['default'].readdirSync(dirPath);

    const handledFiles = files.map((file) => handleItem(dirPath, file));

    return handledFiles;
  } catch (e) {
    throw new Error('[nanoexpress::Middlewares]: {static} Precache failed', e);
  }
}

function handleItem(filePath, file) {
  const resolved = path__default['default'].join(filePath, file);

  const isDirectory = handleDirectory(resolved);
  if (isDirectory !== undefined) {
    return isDirectory;
  }

  const streamable = getMime(resolved);

  return {
    file,
    resolved,
    streamable,
    raw: streamable ? null : fs__default['default'].readFileSync(resolved)
  };
}

function mergeCaches(cache) {
  return cache.reduce((list, item) => {
    if (item.reduce) {
      list = list.concat(item.files);
    } else {
      list.push(item);
    }
    return list;
  }, []);
}

function precacheStatic(dirPath) {
  return mergeCaches(precacheFolder(dirPath));
}

function staticMiddleware(path, config) {
  // Reduce risk of importing files out-of-folder
  if (path.length > 4 && path.charAt(path.length) !== '/') {
    path += '/';
  }

  const items = precacheStatic(path);

  return async function handleServe(req, res) {
    let fileName = req.path;

    if (config.forcePretty || (config.addPrettyUrl && fileName === '/')) {
      fileName += config.index;
    }

    // eslint-disable-next-line no-restricted-syntax
    for (const { streamable, resolved, raw } of items) {
      if (resolved.endsWith(fileName)) {
        if (streamable) {
          return res.sendFile(resolved, config.lastModified, config.compressed);
        }
        return res.end(raw);
      }
    }

    return undefined;
  };
}

const resAbortHandler = '___$HttpResponseAbortHandler';
function staticMiddleware$1(path, config) {
  // eslint-disable-next-line consistent-return
  return async function handleServe(req, res) {
    if (!res[resAbortHandler]) {
      res.onAborted(() => {
        res.aborted = true;
      });
      res[resAbortHandler] = true;
    }

    let url = req.path;

    if (config.forcePretty || (config.addPrettyUrl && url === '/')) {
      url += config.index;
    }

    const filePath = path + url;

    const stat = await fs.promises.stat(filePath).catch(() => null);

    if (stat && !res.aborted) {
      return res.sendFile(filePath, config.lastModified, config.compressed);
    }
  };
}

/**
 * Serves file
 * @param {String} path Path of folder
 * @param {object} options Options of serve
 * @param {String=} options.mode Serve mode, has two values - Cached and Live.
 * Cached gives better performance, but on refresh gives cached result
 * and uses more RAM.
 * Live mode uses less memory usage, on request responses last version
 * but on high-load applicatins may reduces performance
 *
 * @param {Boolean=} options.index Index filename
 * @param {Boolean=} options.forcePretty Force appending index-file
 * path even path isn't as root
 *
 * @param {Boolean=} options.addPrettyUrl Enable pretty url
 * by auto-appending index-file, so works `/` like `/index.html`
 *
 * @param {Boolean=} options.lastModified Enable last-modified check,
 * if file not modified, returns empty request with 304 status
 * @param {Boolean=} options.compressed Compress response/response streams
 * @default options.mode cached `Uses cached mode by default`
 * @default options.index index.html `Default index.html as index-file`
 * @default options.forcePretty false `Disabled by default`
 * @default options.addPrettyUrl true `Enabled by default`
 * @default options.lastModified true `Enabled by default`
 * @default options.compressed true `Enabled by default`
 *
 * @example // If mode is `cached`
 * app.use(await staticServe('./assets/static'))
 * @example // If mode is `live`
 * app.use(staticServe('./assets/static'))
 */
function staticServe(path, config = {}) {
  config = {
    mode: 'cached',
    index: 'index.html',
    forcePretty: false,
    addPrettyUrl: true,
    lastModified: true,
    compressed: true,
    ...config
  };

  if (config.mode === 'live') {
    return staticMiddleware$1(path, config);
  }
  if (config.mode === 'cached') {
    return staticMiddleware(path, config);
  }
  throw new Error('[nanoexpress::Middlewares]: {static} Unknown mode');
}

module.exports = staticServe;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGljLmNqcy5qcyIsInNvdXJjZXMiOlsiLi4vdXRpbHMvbWltZS5qcyIsIi4uL3V0aWxzL3ByZWNhY2hlLWZvbGRlci5qcyIsIi4uL2NhY2hlYWJsZS5qcyIsIi4uL2xpdmUuanMiLCIuLi9zdGF0aWMuZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbWltZXMgPSB7XG4gICczZ3AnOiAndmlkZW8vM2dwcCcsXG4gIGE6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLFxuICBhaTogJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLFxuICBhaWY6ICdhdWRpby94LWFpZmYnLFxuICBhaWZmOiAnYXVkaW8veC1haWZmJyxcbiAgYXNjOiAnYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZScsXG4gIGFzZjogJ3ZpZGVvL3gtbXMtYXNmJyxcbiAgYXNtOiAndGV4dC94LWFzbScsXG4gIGFzeDogJ3ZpZGVvL3gtbXMtYXNmJyxcbiAgYXRvbTogJ2FwcGxpY2F0aW9uL2F0b20reG1sJyxcbiAgYXU6ICdhdWRpby9iYXNpYycsXG4gIGF2aTogJ3ZpZGVvL3gtbXN2aWRlbycsXG4gIGJhdDogJ2FwcGxpY2F0aW9uL3gtbXNkb3dubG9hZCcsXG4gIGJpbjogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gIGJtcDogJ2ltYWdlL2JtcCcsXG4gIGJ6MjogJ2FwcGxpY2F0aW9uL3gtYnppcDInLFxuICBjOiAndGV4dC94LWMnLFxuICBjYWI6ICdhcHBsaWNhdGlvbi92bmQubXMtY2FiLWNvbXByZXNzZWQnLFxuICBjYzogJ3RleHQveC1jJyxcbiAgY2htOiAnYXBwbGljYXRpb24vdm5kLm1zLWh0bWxoZWxwJyxcbiAgY2xhc3M6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLFxuICBjb206ICdhcHBsaWNhdGlvbi94LW1zZG93bmxvYWQnLFxuICBjb25mOiAndGV4dC9wbGFpbicsXG4gIGNwcDogJ3RleHQveC1jJyxcbiAgY3J0OiAnYXBwbGljYXRpb24veC14NTA5LWNhLWNlcnQnLFxuICBjc3M6ICd0ZXh0L2NzcycsXG4gIGNzdjogJ3RleHQvY3N2JyxcbiAgY3h4OiAndGV4dC94LWMnLFxuICBkZWI6ICdhcHBsaWNhdGlvbi94LWRlYmlhbi1wYWNrYWdlJyxcbiAgZGVyOiAnYXBwbGljYXRpb24veC14NTA5LWNhLWNlcnQnLFxuICBkaWZmOiAndGV4dC94LWRpZmYnLFxuICBkanY6ICdpbWFnZS92bmQuZGp2dScsXG4gIGRqdnU6ICdpbWFnZS92bmQuZGp2dScsXG4gIGRsbDogJ2FwcGxpY2F0aW9uL3gtbXNkb3dubG9hZCcsXG4gIGRtZzogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gIGRvYzogJ2FwcGxpY2F0aW9uL21zd29yZCcsXG4gIGRvdDogJ2FwcGxpY2F0aW9uL21zd29yZCcsXG4gIGR0ZDogJ2FwcGxpY2F0aW9uL3htbC1kdGQnLFxuICBkdmk6ICdhcHBsaWNhdGlvbi94LWR2aScsXG4gIGVhcjogJ2FwcGxpY2F0aW9uL2phdmEtYXJjaGl2ZScsXG4gIGVtbDogJ21lc3NhZ2UvcmZjODIyJyxcbiAgZXBzOiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsXG4gIGV4ZTogJ2FwcGxpY2F0aW9uL3gtbXNkb3dubG9hZCcsXG4gIGY6ICd0ZXh0L3gtZm9ydHJhbicsXG4gIGY3NzogJ3RleHQveC1mb3J0cmFuJyxcbiAgZjkwOiAndGV4dC94LWZvcnRyYW4nLFxuICBmbHY6ICd2aWRlby94LWZsdicsXG4gIGZvcjogJ3RleHQveC1mb3J0cmFuJyxcbiAgZ2VtOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyxcbiAgZ2Vtc3BlYzogJ3RleHQveC1zY3JpcHQucnVieScsXG4gIGdpZjogJ2ltYWdlL2dpZicsXG4gIGd6OiAnYXBwbGljYXRpb24veC1nemlwJyxcbiAgaDogJ3RleHQveC1jJyxcbiAgaGg6ICd0ZXh0L3gtYycsXG4gIGh0bTogJ3RleHQvaHRtbCcsXG4gIGh0bWw6ICd0ZXh0L2h0bWwnLFxuICBpY286ICdpbWFnZS92bmQubWljcm9zb2Z0Lmljb24nLFxuICBpY3M6ICd0ZXh0L2NhbGVuZGFyJyxcbiAgaWZiOiAndGV4dC9jYWxlbmRhcicsXG4gIGlzbzogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gIGphcjogJ2FwcGxpY2F0aW9uL2phdmEtYXJjaGl2ZScsXG4gIGphdmE6ICd0ZXh0L3gtamF2YS1zb3VyY2UnLFxuICBqbmxwOiAnYXBwbGljYXRpb24veC1qYXZhLWpubHAtZmlsZScsXG4gIGpwZWc6ICdpbWFnZS9qcGVnJyxcbiAganBnOiAnaW1hZ2UvanBlZycsXG4gIGpzOiAnYXBwbGljYXRpb24vamF2YXNjcmlwdCcsXG4gIGpzb246ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgbG9nOiAndGV4dC9wbGFpbicsXG4gIG0zdTogJ2F1ZGlvL3gtbXBlZ3VybCcsXG4gIG00djogJ3ZpZGVvL21wNCcsXG4gIG1hbjogJ3RleHQvdHJvZmYnLFxuICBtYXRobWw6ICdhcHBsaWNhdGlvbi9tYXRobWwreG1sJyxcbiAgbWJveDogJ2FwcGxpY2F0aW9uL21ib3gnLFxuICBtZG9jOiAndGV4dC90cm9mZicsXG4gIG1lOiAndGV4dC90cm9mZicsXG4gIG1pZDogJ2F1ZGlvL21pZGknLFxuICBtaWRpOiAnYXVkaW8vbWlkaScsXG4gIG1pbWU6ICdtZXNzYWdlL3JmYzgyMicsXG4gIG1qczogJ2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnLFxuICBtbWw6ICdhcHBsaWNhdGlvbi9tYXRobWwreG1sJyxcbiAgbW5nOiAndmlkZW8veC1tbmcnLFxuICBtb3Y6ICd2aWRlby9xdWlja3RpbWUnLFxuICBtcDM6ICdhdWRpby9tcGVnJyxcbiAgbXA0OiAndmlkZW8vbXA0JyxcbiAgbXA0djogJ3ZpZGVvL21wNCcsXG4gIG1wZWc6ICd2aWRlby9tcGVnJyxcbiAgbXBnOiAndmlkZW8vbXBlZycsXG4gIG1zOiAndGV4dC90cm9mZicsXG4gIG1zaTogJ2FwcGxpY2F0aW9uL3gtbXNkb3dubG9hZCcsXG4gIG9kcDogJ2FwcGxpY2F0aW9uL3ZuZC5vYXNpcy5vcGVuZG9jdW1lbnQucHJlc2VudGF0aW9uJyxcbiAgb2RzOiAnYXBwbGljYXRpb24vdm5kLm9hc2lzLm9wZW5kb2N1bWVudC5zcHJlYWRzaGVldCcsXG4gIG9kdDogJ2FwcGxpY2F0aW9uL3ZuZC5vYXNpcy5vcGVuZG9jdW1lbnQudGV4dCcsXG4gIG9nZzogJ2FwcGxpY2F0aW9uL29nZycsXG4gIHA6ICd0ZXh0L3gtcGFzY2FsJyxcbiAgcGFzOiAndGV4dC94LXBhc2NhbCcsXG4gIHBibTogJ2ltYWdlL3gtcG9ydGFibGUtYml0bWFwJyxcbiAgcGRmOiAnYXBwbGljYXRpb24vcGRmJyxcbiAgcGVtOiAnYXBwbGljYXRpb24veC14NTA5LWNhLWNlcnQnLFxuICBwZ206ICdpbWFnZS94LXBvcnRhYmxlLWdyYXltYXAnLFxuICBwZ3A6ICdhcHBsaWNhdGlvbi9wZ3AtZW5jcnlwdGVkJyxcbiAgcGtnOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyxcbiAgcGw6ICd0ZXh0L3gtc2NyaXB0LnBlcmwnLFxuICBwbTogJ3RleHQveC1zY3JpcHQucGVybC1tb2R1bGUnLFxuICBwbmc6ICdpbWFnZS9wbmcnLFxuICBwbm06ICdpbWFnZS94LXBvcnRhYmxlLWFueW1hcCcsXG4gIHBwbTogJ2ltYWdlL3gtcG9ydGFibGUtcGl4bWFwJyxcbiAgcHBzOiAnYXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQnLFxuICBwcHQ6ICdhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCcsXG4gIHBzOiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsXG4gIHBzZDogJ2ltYWdlL3ZuZC5hZG9iZS5waG90b3Nob3AnLFxuICBweTogJ3RleHQveC1zY3JpcHQucHl0aG9uJyxcbiAgcXQ6ICd2aWRlby9xdWlja3RpbWUnLFxuICByYTogJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJyxcbiAgcmFrZTogJ3RleHQveC1zY3JpcHQucnVieScsXG4gIHJhbTogJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJyxcbiAgcmFyOiAnYXBwbGljYXRpb24veC1yYXItY29tcHJlc3NlZCcsXG4gIHJiOiAndGV4dC94LXNjcmlwdC5ydWJ5JyxcbiAgcmRmOiAnYXBwbGljYXRpb24vcmRmK3htbCcsXG4gIHJvZmY6ICd0ZXh0L3Ryb2ZmJyxcbiAgcnBtOiAnYXBwbGljYXRpb24veC1yZWRoYXQtcGFja2FnZS1tYW5hZ2VyJyxcbiAgcnNzOiAnYXBwbGljYXRpb24vcnNzK3htbCcsXG4gIHJ0ZjogJ2FwcGxpY2F0aW9uL3J0ZicsXG4gIHJ1OiAndGV4dC94LXNjcmlwdC5ydWJ5JyxcbiAgczogJ3RleHQveC1hc20nLFxuICBzZ206ICd0ZXh0L3NnbWwnLFxuICBzZ21sOiAndGV4dC9zZ21sJyxcbiAgc2g6ICdhcHBsaWNhdGlvbi94LXNoJyxcbiAgc2lnOiAnYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZScsXG4gIHNuZDogJ2F1ZGlvL2Jhc2ljJyxcbiAgc286ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLFxuICBzdmc6ICdpbWFnZS9zdmcreG1sJyxcbiAgc3ZnejogJ2ltYWdlL3N2Zyt4bWwnLFxuICBzd2Y6ICdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcsXG4gIHQ6ICd0ZXh0L3Ryb2ZmJyxcbiAgdGFyOiAnYXBwbGljYXRpb24veC10YXInLFxuICB0Yno6ICdhcHBsaWNhdGlvbi94LWJ6aXAtY29tcHJlc3NlZC10YXInLFxuICB0Y2w6ICdhcHBsaWNhdGlvbi94LXRjbCcsXG4gIHRleDogJ2FwcGxpY2F0aW9uL3gtdGV4JyxcbiAgdGV4aTogJ2FwcGxpY2F0aW9uL3gtdGV4aW5mbycsXG4gIHRleGluZm86ICdhcHBsaWNhdGlvbi94LXRleGluZm8nLFxuICB0ZXh0OiAndGV4dC9wbGFpbicsXG4gIHRpZjogJ2ltYWdlL3RpZmYnLFxuICB0aWZmOiAnaW1hZ2UvdGlmZicsXG4gIHRvcnJlbnQ6ICdhcHBsaWNhdGlvbi94LWJpdHRvcnJlbnQnLFxuICB0cjogJ3RleHQvdHJvZmYnLFxuICB0eHQ6ICd0ZXh0L3BsYWluJyxcbiAgdmNmOiAndGV4dC94LXZjYXJkJyxcbiAgdmNzOiAndGV4dC94LXZjYWxlbmRhcicsXG4gIHZybWw6ICdtb2RlbC92cm1sJyxcbiAgd2FyOiAnYXBwbGljYXRpb24vamF2YS1hcmNoaXZlJyxcbiAgd2F2OiAnYXVkaW8veC13YXYnLFxuICB3bWE6ICdhdWRpby94LW1zLXdtYScsXG4gIHdtdjogJ3ZpZGVvL3gtbXMtd212JyxcbiAgd214OiAndmlkZW8veC1tcy13bXgnLFxuICB3cmw6ICdtb2RlbC92cm1sJyxcbiAgd3NkbDogJ2FwcGxpY2F0aW9uL3dzZGwreG1sJyxcbiAgeGJtOiAnaW1hZ2UveC14Yml0bWFwJyxcbiAgeGh0bWw6ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLFxuICB4bHM6ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnLFxuICB4bWw6ICdhcHBsaWNhdGlvbi94bWwnLFxuICB4cG06ICdpbWFnZS94LXhwaXhtYXAnLFxuICB4c2w6ICdhcHBsaWNhdGlvbi94bWwnLFxuICB4c2x0OiAnYXBwbGljYXRpb24veHNsdCt4bWwnLFxuICB5YW1sOiAndGV4dC95YW1sJyxcbiAgeW1sOiAndGV4dC95YW1sJyxcbiAgemlwOiAnYXBwbGljYXRpb24vemlwJyxcbiAgZGVmYXVsdDogJ3RleHQvaHRtbCdcbn07XG5cbmNvbnN0IGdldE1pbWUgPSAocGF0aCkgPT4ge1xuICBjb25zdCBpID0gcGF0aC5sYXN0SW5kZXhPZignLicpO1xuICByZXR1cm4gbWltZXNbcGF0aC5zdWJzdHIoaSArIDEpLnRvTG93ZXJDYXNlKCldO1xufTtcblxuZXhwb3J0IHsgZ2V0TWltZSwgbWltZXMgfTtcbiIsIi8qIGVzbGludC1kaXNhYmxlIGVzbGludC1jb21tZW50cy9kaXNhYmxlLWVuYWJsZS1wYWlyLCBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdXNlLWJlZm9yZS1kZWZpbmUgKi9cbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGdldE1pbWUgfSBmcm9tICcuL21pbWUuanMnO1xuXG5mdW5jdGlvbiBoYW5kbGVEaXJlY3RvcnkoZGlyUGF0aCkge1xuICBpZiAoZnMuc3RhdFN5bmMoZGlyUGF0aCkuaXNEaXJlY3RvcnkoKSkge1xuICAgIHJldHVybiB7XG4gICAgICBmaWxlczogcHJlY2FjaGVTdGF0aWMoZGlyUGF0aCksXG4gICAgICByZWR1Y2U6IHRydWVcbiAgICB9O1xuICB9XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIHByZWNhY2hlRm9sZGVyKGRpclBhdGgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBmaWxlcyA9IGZzLnJlYWRkaXJTeW5jKGRpclBhdGgpO1xuXG4gICAgY29uc3QgaGFuZGxlZEZpbGVzID0gZmlsZXMubWFwKChmaWxlKSA9PiBoYW5kbGVJdGVtKGRpclBhdGgsIGZpbGUpKTtcblxuICAgIHJldHVybiBoYW5kbGVkRmlsZXM7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1tuYW5vZXhwcmVzczo6TWlkZGxld2FyZXNdOiB7c3RhdGljfSBQcmVjYWNoZSBmYWlsZWQnLCBlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVJdGVtKGZpbGVQYXRoLCBmaWxlKSB7XG4gIGNvbnN0IHJlc29sdmVkID0gcGF0aC5qb2luKGZpbGVQYXRoLCBmaWxlKTtcblxuICBjb25zdCBpc0RpcmVjdG9yeSA9IGhhbmRsZURpcmVjdG9yeShyZXNvbHZlZCk7XG4gIGlmIChpc0RpcmVjdG9yeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIGlzRGlyZWN0b3J5O1xuICB9XG5cbiAgY29uc3Qgc3RyZWFtYWJsZSA9IGdldE1pbWUocmVzb2x2ZWQpO1xuXG4gIHJldHVybiB7XG4gICAgZmlsZSxcbiAgICByZXNvbHZlZCxcbiAgICBzdHJlYW1hYmxlLFxuICAgIHJhdzogc3RyZWFtYWJsZSA/IG51bGwgOiBmcy5yZWFkRmlsZVN5bmMocmVzb2x2ZWQpXG4gIH07XG59XG5cbmZ1bmN0aW9uIG1lcmdlQ2FjaGVzKGNhY2hlKSB7XG4gIHJldHVybiBjYWNoZS5yZWR1Y2UoKGxpc3QsIGl0ZW0pID0+IHtcbiAgICBpZiAoaXRlbS5yZWR1Y2UpIHtcbiAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChpdGVtLmZpbGVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGlzdC5wdXNoKGl0ZW0pO1xuICAgIH1cbiAgICByZXR1cm4gbGlzdDtcbiAgfSwgW10pO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBwcmVjYWNoZVN0YXRpYyhkaXJQYXRoKSB7XG4gIHJldHVybiBtZXJnZUNhY2hlcyhwcmVjYWNoZUZvbGRlcihkaXJQYXRoKSk7XG59XG4iLCJpbXBvcnQgcHJlY2FjaGVTdGF0aWMgZnJvbSAnLi91dGlscy9wcmVjYWNoZS1mb2xkZXIuanMnO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzdGF0aWNNaWRkbGV3YXJlKHBhdGgsIGNvbmZpZykge1xuICAvLyBSZWR1Y2UgcmlzayBvZiBpbXBvcnRpbmcgZmlsZXMgb3V0LW9mLWZvbGRlclxuICBpZiAocGF0aC5sZW5ndGggPiA0ICYmIHBhdGguY2hhckF0KHBhdGgubGVuZ3RoKSAhPT0gJy8nKSB7XG4gICAgcGF0aCArPSAnLyc7XG4gIH1cblxuICBjb25zdCBpdGVtcyA9IHByZWNhY2hlU3RhdGljKHBhdGgpO1xuXG4gIHJldHVybiBhc3luYyBmdW5jdGlvbiBoYW5kbGVTZXJ2ZShyZXEsIHJlcykge1xuICAgIGxldCBmaWxlTmFtZSA9IHJlcS5wYXRoO1xuXG4gICAgaWYgKGNvbmZpZy5mb3JjZVByZXR0eSB8fCAoY29uZmlnLmFkZFByZXR0eVVybCAmJiBmaWxlTmFtZSA9PT0gJy8nKSkge1xuICAgICAgZmlsZU5hbWUgKz0gY29uZmlnLmluZGV4O1xuICAgIH1cblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgIGZvciAoY29uc3QgeyBzdHJlYW1hYmxlLCByZXNvbHZlZCwgcmF3IH0gb2YgaXRlbXMpIHtcbiAgICAgIGlmIChyZXNvbHZlZC5lbmRzV2l0aChmaWxlTmFtZSkpIHtcbiAgICAgICAgaWYgKHN0cmVhbWFibGUpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnNlbmRGaWxlKHJlc29sdmVkLCBjb25maWcubGFzdE1vZGlmaWVkLCBjb25maWcuY29tcHJlc3NlZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcy5lbmQocmF3KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xufVxuIiwiaW1wb3J0IHsgcHJvbWlzZXMgYXMgZnMgfSBmcm9tICdmcyc7XG5cbmV4cG9ydCBjb25zdCByZXNBYm9ydEhhbmRsZXIgPSAnX19fJEh0dHBSZXNwb25zZUFib3J0SGFuZGxlcic7XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzdGF0aWNNaWRkbGV3YXJlKHBhdGgsIGNvbmZpZykge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29uc2lzdGVudC1yZXR1cm5cbiAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNlcnZlKHJlcSwgcmVzKSB7XG4gICAgaWYgKCFyZXNbcmVzQWJvcnRIYW5kbGVyXSkge1xuICAgICAgcmVzLm9uQWJvcnRlZCgoKSA9PiB7XG4gICAgICAgIHJlcy5hYm9ydGVkID0gdHJ1ZTtcbiAgICAgIH0pO1xuICAgICAgcmVzW3Jlc0Fib3J0SGFuZGxlcl0gPSB0cnVlO1xuICAgIH1cblxuICAgIGxldCB1cmwgPSByZXEucGF0aDtcblxuICAgIGlmIChjb25maWcuZm9yY2VQcmV0dHkgfHwgKGNvbmZpZy5hZGRQcmV0dHlVcmwgJiYgdXJsID09PSAnLycpKSB7XG4gICAgICB1cmwgKz0gY29uZmlnLmluZGV4O1xuICAgIH1cblxuICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aCArIHVybDtcblxuICAgIGNvbnN0IHN0YXQgPSBhd2FpdCBmcy5zdGF0KGZpbGVQYXRoKS5jYXRjaCgoKSA9PiBudWxsKTtcblxuICAgIGlmIChzdGF0ICYmICFyZXMuYWJvcnRlZCkge1xuICAgICAgcmV0dXJuIHJlcy5zZW5kRmlsZShmaWxlUGF0aCwgY29uZmlnLmxhc3RNb2RpZmllZCwgY29uZmlnLmNvbXByZXNzZWQpO1xuICAgIH1cbiAgfTtcbn1cbiIsImltcG9ydCBjYWNoZWFibGUgZnJvbSAnLi9jYWNoZWFibGUuanMnO1xuaW1wb3J0IGxpdmUgZnJvbSAnLi9saXZlLmpzJztcblxuLyoqXG4gKiBTZXJ2ZXMgZmlsZVxuICogQHBhcmFtIHtTdHJpbmd9IHBhdGggUGF0aCBvZiBmb2xkZXJcbiAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIE9wdGlvbnMgb2Ygc2VydmVcbiAqIEBwYXJhbSB7U3RyaW5nPX0gb3B0aW9ucy5tb2RlIFNlcnZlIG1vZGUsIGhhcyB0d28gdmFsdWVzIC0gQ2FjaGVkIGFuZCBMaXZlLlxuICogQ2FjaGVkIGdpdmVzIGJldHRlciBwZXJmb3JtYW5jZSwgYnV0IG9uIHJlZnJlc2ggZ2l2ZXMgY2FjaGVkIHJlc3VsdFxuICogYW5kIHVzZXMgbW9yZSBSQU0uXG4gKiBMaXZlIG1vZGUgdXNlcyBsZXNzIG1lbW9yeSB1c2FnZSwgb24gcmVxdWVzdCByZXNwb25zZXMgbGFzdCB2ZXJzaW9uXG4gKiBidXQgb24gaGlnaC1sb2FkIGFwcGxpY2F0aW5zIG1heSByZWR1Y2VzIHBlcmZvcm1hbmNlXG4gKlxuICogQHBhcmFtIHtCb29sZWFuPX0gb3B0aW9ucy5pbmRleCBJbmRleCBmaWxlbmFtZVxuICogQHBhcmFtIHtCb29sZWFuPX0gb3B0aW9ucy5mb3JjZVByZXR0eSBGb3JjZSBhcHBlbmRpbmcgaW5kZXgtZmlsZVxuICogcGF0aCBldmVuIHBhdGggaXNuJ3QgYXMgcm9vdFxuICpcbiAqIEBwYXJhbSB7Qm9vbGVhbj19IG9wdGlvbnMuYWRkUHJldHR5VXJsIEVuYWJsZSBwcmV0dHkgdXJsXG4gKiBieSBhdXRvLWFwcGVuZGluZyBpbmRleC1maWxlLCBzbyB3b3JrcyBgL2AgbGlrZSBgL2luZGV4Lmh0bWxgXG4gKlxuICogQHBhcmFtIHtCb29sZWFuPX0gb3B0aW9ucy5sYXN0TW9kaWZpZWQgRW5hYmxlIGxhc3QtbW9kaWZpZWQgY2hlY2ssXG4gKiBpZiBmaWxlIG5vdCBtb2RpZmllZCwgcmV0dXJucyBlbXB0eSByZXF1ZXN0IHdpdGggMzA0IHN0YXR1c1xuICogQHBhcmFtIHtCb29sZWFuPX0gb3B0aW9ucy5jb21wcmVzc2VkIENvbXByZXNzIHJlc3BvbnNlL3Jlc3BvbnNlIHN0cmVhbXNcbiAqIEBkZWZhdWx0IG9wdGlvbnMubW9kZSBjYWNoZWQgYFVzZXMgY2FjaGVkIG1vZGUgYnkgZGVmYXVsdGBcbiAqIEBkZWZhdWx0IG9wdGlvbnMuaW5kZXggaW5kZXguaHRtbCBgRGVmYXVsdCBpbmRleC5odG1sIGFzIGluZGV4LWZpbGVgXG4gKiBAZGVmYXVsdCBvcHRpb25zLmZvcmNlUHJldHR5IGZhbHNlIGBEaXNhYmxlZCBieSBkZWZhdWx0YFxuICogQGRlZmF1bHQgb3B0aW9ucy5hZGRQcmV0dHlVcmwgdHJ1ZSBgRW5hYmxlZCBieSBkZWZhdWx0YFxuICogQGRlZmF1bHQgb3B0aW9ucy5sYXN0TW9kaWZpZWQgdHJ1ZSBgRW5hYmxlZCBieSBkZWZhdWx0YFxuICogQGRlZmF1bHQgb3B0aW9ucy5jb21wcmVzc2VkIHRydWUgYEVuYWJsZWQgYnkgZGVmYXVsdGBcbiAqXG4gKiBAZXhhbXBsZSAvLyBJZiBtb2RlIGlzIGBjYWNoZWRgXG4gKiBhcHAudXNlKGF3YWl0IHN0YXRpY1NlcnZlKCcuL2Fzc2V0cy9zdGF0aWMnKSlcbiAqIEBleGFtcGxlIC8vIElmIG1vZGUgaXMgYGxpdmVgXG4gKiBhcHAudXNlKHN0YXRpY1NlcnZlKCcuL2Fzc2V0cy9zdGF0aWMnKSlcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gc3RhdGljU2VydmUocGF0aCwgY29uZmlnID0ge30pIHtcbiAgY29uZmlnID0ge1xuICAgIG1vZGU6ICdjYWNoZWQnLFxuICAgIGluZGV4OiAnaW5kZXguaHRtbCcsXG4gICAgZm9yY2VQcmV0dHk6IGZhbHNlLFxuICAgIGFkZFByZXR0eVVybDogdHJ1ZSxcbiAgICBsYXN0TW9kaWZpZWQ6IHRydWUsXG4gICAgY29tcHJlc3NlZDogdHJ1ZSxcbiAgICAuLi5jb25maWdcbiAgfTtcblxuICBpZiAoY29uZmlnLm1vZGUgPT09ICdsaXZlJykge1xuICAgIHJldHVybiBsaXZlKHBhdGgsIGNvbmZpZyk7XG4gIH1cbiAgaWYgKGNvbmZpZy5tb2RlID09PSAnY2FjaGVkJykge1xuICAgIHJldHVybiBjYWNoZWFibGUocGF0aCwgY29uZmlnKTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoJ1tuYW5vZXhwcmVzczo6TWlkZGxld2FyZXNdOiB7c3RhdGljfSBVbmtub3duIG1vZGUnKTtcbn1cbiJdLCJuYW1lcyI6WyJmcyIsInBhdGgiLCJzdGF0aWNNaWRkbGV3YXJlIiwibGl2ZSIsImNhY2hlYWJsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLE1BQU0sS0FBSyxHQUFHO0FBQ2QsRUFBRSxLQUFLLEVBQUUsWUFBWTtBQUNyQixFQUFFLENBQUMsRUFBRSwwQkFBMEI7QUFDL0IsRUFBRSxFQUFFLEVBQUUsd0JBQXdCO0FBQzlCLEVBQUUsR0FBRyxFQUFFLGNBQWM7QUFDckIsRUFBRSxJQUFJLEVBQUUsY0FBYztBQUN0QixFQUFFLEdBQUcsRUFBRSwyQkFBMkI7QUFDbEMsRUFBRSxHQUFHLEVBQUUsZ0JBQWdCO0FBQ3ZCLEVBQUUsR0FBRyxFQUFFLFlBQVk7QUFDbkIsRUFBRSxHQUFHLEVBQUUsZ0JBQWdCO0FBQ3ZCLEVBQUUsSUFBSSxFQUFFLHNCQUFzQjtBQUM5QixFQUFFLEVBQUUsRUFBRSxhQUFhO0FBQ25CLEVBQUUsR0FBRyxFQUFFLGlCQUFpQjtBQUN4QixFQUFFLEdBQUcsRUFBRSwwQkFBMEI7QUFDakMsRUFBRSxHQUFHLEVBQUUsMEJBQTBCO0FBQ2pDLEVBQUUsR0FBRyxFQUFFLFdBQVc7QUFDbEIsRUFBRSxHQUFHLEVBQUUscUJBQXFCO0FBQzVCLEVBQUUsQ0FBQyxFQUFFLFVBQVU7QUFDZixFQUFFLEdB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
